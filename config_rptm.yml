# NOTE n.1 : If sampler_type 'random' or 'balanced' is selected, batch_size must be divisible by num_instances
# NOTE n.2 : If sampler_type 'random' or 'balanced' is selected, loss type must be TripletLoss
# NOTE n.3 : If use_rptm is True, loss must be TripletLossV2

reid:
  seed: 2047315 # Seed for reproducibility
  # === DATASET CONFIGURATION ===
  dataset:
    data_path: "data"
    dataset_name: "veri_776" # veri_776 / veri_wild / vehicleid
    dataset_size: "small"
    sampler_type: '' # random / balanced / ''
    num_instances: 6 # Only to be adjusted if sampler_type is either 'random' or 'balanced'

  # === MODEL CONFIGURATION ===
  model:
    model: "resnet50_ibn_a" # 'resnet50' / 'resnet101' / 'resnet50_ibn_a' / 'resnet101_ibn_a'
    pretrained: True
    device: "cuda:0"
    use_gem: False
    use_stride: True
    use_bottleneck: True

  # === AUGMENTATION CONFIGURATION ===
  augmentation:
    height: 320
    width: 320
    random_horizontal_flip_prob: 0.5
    random_erasing_prob: 0.5
    jitter_brightness: 0.2
    jitter_contrast: 0.15
    jitter_saturation: 0.0
    jitter_hue: 0.0
    padding: 10
    normalize_mean: [0.485, 0.456, 0.406]
    normalize_std: [0.229, 0.224, 0.225]
    
  # === LOSS CONFIGURATION ===
  loss:
    type: "TripletLossV2" # TripletLoss / TripletLossV2 / SupConLoss / SupConLoss_Pytorch / TripletMarginLoss_Pytorch
    use_rptm: [True, 'mean']
    alpha: 0.9
    k: 1000
    margin: 1.00
    label_smoothing: 0.00
    apply_MALW: False

  # === TRAINING CONFIGURATION ===
  training:
    epochs: 80
    batch_size: 20
    num_workers: 0
    output_dir: "results"
    use_amp: True
    # ===> Optimizer configuration
    optimizer: "sgd" # adam / sgd
    learning_rate: 5.0e-3
    bias_lr_factor: 2
    weight_decay: 0.0005
    weight_decay_bias: 0.0001
    # ===> Scheduler configuration (WarmupDecayLR or MultiStepLR)
    use_warmup: False
    steps: [20, 40, 60]
    warmup_gamma: 0.1
    warmup_epochs: 10
    decay_method: "smooth"
    log_interval: 100
    # ===> Loading checkpoint
    load_checkpoint: False # Could be also a path to a checkpoint

  # === VALIDATION CONFIGURATION ===
  validation:
    batch_size: 100
    val_interval: 1
    re_ranking: True

  # === TEST CONFIGURATION ===
  test:
    normalize_embeddings: False
    run_reid_metrics: True
    model_val_path: ""